<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>선수 기록 보기</title>
    <style>
        .table-container {
            width: 100%;
            margin: 0;
            display: flex;
            overflow: hidden;
        }

        .fixed-column {
            width: 80px;
            border-collapse: collapse;
            background-color: white;
        }

        .fixed-column th, .fixed-column td {
            padding: 10px;
            text-align: center;
            border: 1px solid lightgray;
            background-color: white;
        }

        .scrollable-table-container {
            width: 100%;
            overflow-x: auto;
        }

        .scrollable-table {
            width: 40%;
            border-collapse: collapse;
            background-color: white;
            min-width: 400px;
        }

        .scrollable-table th, .scrollable-table td {
            width: 10px;
            text-align: center;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            border: 1px solid lightgray;
            background-color: #e0e0e0;
        }
        
        .scrollable-table th {
            position: sticky;
            top: 0;
            font-weight: normal;
            background-color: white;
            cursor: pointer; /* 클릭 가능한 손 모양 커서 추가 */
        }

        .scrollable-table td.selected, .scrollable-table th.selected {
            background-color: white;
            color: #6495ED;
        }
    </style>
    <script>
    let currentSortColumn = 'goals';
    let currentSortDirection = 'desc';
    let cachedData;

    function sortTable(a, b) {
        const column = currentSortColumn;
        if (a[column] !== b[column]) {
            return currentSortDirection === 'desc' ? b[column] - a[column] : a[column] - b[column];
        }
        return 0;
    }

    function highlightSelectedColumn(columnIndex) {
        const allCells = document.querySelectorAll('.scrollable-table td, .scrollable-table th');
        allCells.forEach(cell => {
            cell.classList.remove('selected');
            cell.style.backgroundColor = '#e0e0e0';
            cell.style.color = '';
        });

        const selectedCells = document.querySelectorAll(`.scrollable-table td:nth-child(${columnIndex}), .scrollable-table th:nth-child(${columnIndex})`);
        selectedCells.forEach(cell => {
            cell.classList.add('selected');
            cell.style.backgroundColor = 'white';
            cell.style.color = '#6495ED';
        });
    }

    function displayPlayerRecord(sortedData) {
    if (sortedData) {
        let fixedColumnHtml = '<table class="fixed-column"><tr><th>이름</th></tr>';
        sortedData.forEach(player => {
            fixedColumnHtml += `<tr><td>${player.name}</td></tr>`;
        });
        fixedColumnHtml += '</table>';

        let scrollableTableHtml = `
            <table class="scrollable-table">
                <tr>
                    <th onclick="sortBy('goals', 1)">득점</th>
                    <th onclick="sortBy('assists', 2)">도움</th>
                    <th onclick="sortBy('attackP', 3)">공격P</th>
                    <th onclick="sortBy('matches', 4)">경기수</th>
                    <th onclick="sortBy('MOM', 5)">MOM</th>
                </tr>
        `;

        sortedData.forEach(player => {
            scrollableTableHtml += `
                <tr>
                    <td>${player.goals}</td>
                    <td>${player.assists}</td>
                    <td>${player.attackP}</td>
                    <td>${player.matches}</td>
                    <td>${player.MOM}</td>
                </tr>`;
        });

        scrollableTableHtml += '</table>';

        document.getElementById('fixedColumn').innerHTML = fixedColumnHtml;
        document.getElementById('scrollableTable').innerHTML = scrollableTableHtml;

        requestAnimationFrame(() => {
            matchRowHeights();
        });
    } else {
        document.getElementById('playerData').innerText = '캐시된 데이터를 찾을 수 없습니다.';
    }
}


    function sortBy(column, columnIndex) {
        currentSortDirection = (currentSortColumn === column && currentSortDirection === 'desc') ? 'asc' : 'desc';
        currentSortColumn = column;
    
        const sortedData = sortData(getFilteredData(cachedData.players));
        displayPlayerRecord(sortedData);
        highlightSelectedColumn(columnIndex);
    }

    const data = cachedData?.players;
    const currentYear = new Date().getFullYear();

    if (data) {
        const filteredData = Object.keys(data).map(number => {
            const player = data[number];
            return {
                number: number,  // 등번호 포함
                name: player.name,
                goals: player.years[currentYear]?.goals || 0,
                assists: player.years[currentYear]?.assists || 0,
                attackP: player.years[currentYear]?.attackP || 0,
                matches: player.years[currentYear]?.matches || 0,
                MOM: player.years[currentYear]?.MOM || 0
            };
        });

        const sortedData = filteredData.sort((a, b) => {
            const aValue = a[column] || 0;
            const bValue = b[column] || 0;
            return currentSortDirection === 'desc' ? bValue - aValue : aValue - bValue;
        });

        displayPlayerRecord(sortedData);
        highlightSelectedColumn(columnIndex);
    }
        
        function getFilteredData(data) {
    const currentYear = new Date().getFullYear();
    return Object.values(data).map(player => ({
        name: player.name,
        goals: player.years[currentYear]?.goals || 0,
        assists: player.years[currentYear]?.assists || 0,
        attackP: player.years[currentYear]?.attackP || 0,
        matches: player.years[currentYear]?.matches || 0,
        MOM: player.years[currentYear]?.MOM || 0
    }));
}

function sortData(data) {
    return data.sort((a, b) => {
        const aValue = a[currentSortColumn] || 0;
        const bValue = b[currentSortColumn] || 0;
        return currentSortDirection === 'desc' ? bValue - aValue : aValue - bValue;
    });
}

    function matchRowHeights() {
        const fixedRows = document.querySelectorAll('.fixed-column tr');
        const scrollableRows = document.querySelectorAll('.scrollable-table tr');

        fixedRows.forEach((row, index) => {
            const fixedHeight = row.getBoundingClientRect().height;
            const scrollableHeight = scrollableRows[index].getBoundingClientRect().height;
            const maxHeight = Math.max(fixedHeight, scrollableHeight);

            row.style.height = `${maxHeight}px`;
            scrollableRows[index].style.height = `${maxHeight}px`;
        });
    }

    window.onload = function() {
    const rawData = localStorage.getItem('cachedData');
    cachedData = rawData ? JSON.parse(rawData) : null;

    if (cachedData?.players) {
        const filteredData = getFilteredData(cachedData.players);
        const sortedData = sortData(filteredData);
        displayPlayerRecord(sortedData);
        highlightSelectedColumn(1);
    } else {
        document.getElementById('playerData').innerText = '캐시된 데이터를 찾을 수 없습니다.';
    }
};

</script>
</head>
<body>
    <h1>선수 기록</h1>
    <div class="table-container">
        <div id="fixedColumn"></div>
        <div class="scrollable-table-container">
            <div id="scrollableTable"></div>
        </div>
    </div>
</body>
</html>
