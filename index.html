<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메인 페이지</title>
    <script>
        let cachedData = {};
        let lastUpdated = null;

        // 시간을 형식화하는 함수
        function formatTime(date) {
            return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}:${date.getSeconds().toString().padStart(2, '0')}`;
        }

        // 데이터 갱신 및 캐싱하는 함수
        async function fetchData() {
            try {
                document.getElementById('status').innerText = '데이터를 불러오는 중...';
                
                const [playerRecordResponse, matchRecordResponse, playerDataResponse] = await Promise.all([
                    fetch('https://script.google.com/macros/s/AKfycbwr4inHtj2P_4NNIVBJCiPFWESOfa_pSKEdSJHjLIes0K_FjL25CYBky3VUsyOUi-9e/exec?sheet=PlayerRecord'),
                    fetch('https://script.google.com/macros/s/AKfycbwr4inHtj2P_4NNIVBJCiPFWESOfa_pSKEdSJHjLIes0K_FjL25CYBky3VUsyOUi-9e/exec?sheet=MatchRecord'),
                    fetch('https://script.google.com/macros/s/AKfycbwr4inHtj2P_4NNIVBJCiPFWESOfa_pSKEdSJHjLIes0K_FjL25CYBky3VUsyOUi-9e/exec?sheet=PlayerData')
                ]);
                
                if (!playerRecordResponse.ok || !matchRecordResponse.ok || !playerDataResponse.ok) {
                    throw new Error('데이터 응답 실패');
                }
                
                const [playerRecord, matchRecord, playerData] = await Promise.all([
                    playerRecordResponse.json(),
                    matchRecordResponse.json(),
                    playerDataResponse.json()
                ]);
                
                cachedData = { playerRecord, matchRecord, playerData };
                
                lastUpdated = new Date().getTime();
                localStorage.setItem('cachedData', JSON.stringify(cachedData));
                localStorage.setItem('lastUpdated', lastUpdated);
                
                document.getElementById('status').innerText = '데이터가 성공적으로 업데이트되었습니다.';
                updateTimeInfo();
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('status').innerText = '데이터를 불러오는 중 오류가 발생했습니다.';
            }
        }

        // 최근 갱신 시간 표시
        function updateTimeInfo() {
            const lastUpdatedTime = new Date(lastUpdated);
            document.getElementById('lastUpdate').innerText = `최근 데이터 갱신 시간: ${formatTime(lastUpdatedTime)}`;
        }

        window.onload = function() {
            fetchData(); // 페이지 로드 시 데이터 자동 갱신
        };

         window.onpopstate = function() {
        fetchData(); // 뒤로가기 시에도 데이터 갱신
        };    
    </script>
</head>
<body>
    <h1>메인 페이지에 오신 것을 환영합니다!</h1>
    <!-- 네비게이션 바 -->
    <nav>
        <ul style="list-style: none; display: flex; justify-content: space-around; padding: 0;">
            <li><a href="MatchRecord.html">최근 전적</a></li>
            <li><a href="PlayerData.html">선수 데이터</a></li>
            <li><a href="PlayerRecord.html">선수기록</a></li>
        </ul>
    </nav>

    <!-- 상태 및 시간 정보 표시 -->
    <div id="status">데이터 상태: 로딩 중...</div>
    <div id="lastUpdate"></div>
</body>
</html>
