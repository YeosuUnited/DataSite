<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>선수 기록 보기</title>
    <style>
        .table-container {
            width: 100%; /* 테이블이 화면 전체 너비를 차지하도록 수정 */
            margin: 0; /* 여백을 제거 */
            display: flex;
            overflow: hidden;
        }

        /* 이름 열을 고정한 테이블 */
        .fixed-column {
            width: 80px; /* 너비 자동으로 설정 */
            border-collapse: collapse;
            background-color: white;
        }

        .fixed-column th, .fixed-column td {
            padding: 10px;
            text-align: center;
            border: 1px solid lightgray;
            background-color: white; /* 1열(이름 열)은 항상 흰색 */
        }

        /* 슬라이드 가능한 나머지 테이블 */
        .scrollable-table-container {
            width: 100%; /* 나머지 표도 화면 전체 너비 차지 */
            overflow-x: auto;
        }

        .scrollable-table {
            width: 100%; /* 테이블이 화면 양 끝에 붙도록 설정 */
            table-layout: fixed; /* 고정된 테이블 레이아웃 사용 */
            border-collapse: collapse;
            background-color: white;
            min-width: 800px; /* 최소 너비는 유지 */
        }

        .scrollable-table th, .scrollable-table td {
            width: 10px;
            text-align: center;
            text-overflow: ellipsis; /* 잘린 부분에 ... 표시 */
            border: 1px solid lightgray;
            background-color: #e0e0e0; /* 기본적으로 회색 */
        }

        .scrollable-table th {
            position: sticky;
            top: 0;
            font-weight: normal;
            background-color: white; /* 슬라이드 테이블의 헤더는 흰색 */
        }

        .scrollable-table td.selected, .scrollable-table th.selected {
            background-color: white; /* 선택된 열은 흰색 */
            color: lightblue; /* 선택된 열의 글자를 연한 파란색으로 변경 */
        }

    </style>
    <script>
        let currentSortColumn = '득점'; // 기본 정렬 기준
        let currentSortDirection = 'desc'; // 기본 내림차순

        function sortTable(data, column, direction) {
            return data.sort((a, b) => {
                let valA = a[column];
                let valB = b[column];
                
                if (!isNaN(valA) && !isNaN(valB)) {
                    valA = Number(valA);
                    valB = Number(valB);
                }

                if (valA > valB) {
                    return direction === 'desc' ? -1 : 1;
                }
                if (valA < valB) {
                    return direction === 'desc' ? 1 : -1;
                }
                return 0;
            });
        }

        function highlightSelectedColumn(columnIndex) {
            // 모든 셀의 선택 효과 제거
            const allCells = document.querySelectorAll('.scrollable-table td, .scrollable-table th');
            allCells.forEach(cell => {
                cell.classList.remove('selected');
                cell.style.backgroundColor = '#e0e0e0'; // 선택되지 않은 셀의 배경색을 진한 회색으로 설정
                cell.style.color = ''; // 글자 색 초기화
            });
        
            // 선택된 열의 셀에 selected 클래스 추가 및 스타일 적용
            const selectedCells = document.querySelectorAll(`.scrollable-table td:nth-child(${columnIndex + 1}), .scrollable-table th:nth-child(${columnIndex + 1})`);
            selectedCells.forEach(cell => {
                cell.classList.add('selected');
                cell.style.backgroundColor = 'white'; // 선택된 열의 배경을 흰색으로 설정
                cell.style.color = 'lightblue'; // 선택된 열의 글자 색을 연한 파란색으로 설정
            });
        }



        function displayPlayerRecord() {
            const cachedData = JSON.parse(localStorage.getItem('cachedData'));
            const data = cachedData?.playerRecord;

            if (data) {
                let sortedData = sortTable(data, currentSortColumn, currentSortDirection);

                // 고정된 이름 열 테이블
                let fixedColumnHtml = '<table class="fixed-column"><tr><th>이름</th></tr>';
                sortedData.forEach(player => {
                    fixedColumnHtml += `<tr><td>${player.이름}</td></tr>`;
                });
                fixedColumnHtml += '</table>';

                // 슬라이드 가능한 나머지 테이블
                let scrollableTableHtml = '<table class="scrollable-table"><tr>' +
                    `<th class="${currentSortColumn === '득점' ? 'highlight' : ''}" onclick="sortBy('득점', 1)">득점</th>` +
                    `<th class="${currentSortColumn === '도움' ? 'highlight' : ''}" onclick="sortBy('도움', 2)">도움</th>` +
                    `<th class="${currentSortColumn === '공격포인트' ? 'highlight' : ''}" onclick="sortBy('공격포인트', 3)">공격포인트</th>` +
                    `<th class="${currentSortColumn === '경기수' ? 'highlight' : ''}" onclick="sortBy('경기수', 4)">경기수</th>` +
                    `<th class="${currentSortColumn === 'MOM' ? 'highlight' : ''}" onclick="sortBy('MOM', 5)">MOM</th>` +
                    `<th class="${currentSortColumn === '승' ? 'highlight' : ''}" onclick="sortBy('승', 6)">승</th>` +
                    `<th class="${currentSortColumn === '패' ? 'highlight' : ''}" onclick="sortBy('패', 7)">패</th>` +
                    '</tr>';

                sortedData.forEach(player => {
                    scrollableTableHtml += `<tr>
                                                <td>${player.득점}</td>
                                                <td>${player.도움}</td>
                                                <td>${player.공격포인트}</td>
                                                <td>${player.경기수}</td>
                                                <td>${player.MOM}</td>
                                                <td>${player.승}</td>
                                                <td>${player.패}</td>
                                             </tr>`;
                });
                scrollableTableHtml += '</table>';

                document.getElementById('fixedColumn').innerHTML = fixedColumnHtml;
                document.getElementById('scrollableTable').innerHTML = scrollableTableHtml;

                // 테이블 렌더링 후 높이 맞추기
                requestAnimationFrame(() => {
                    matchRowHeights();
                });
            } else {
                document.getElementById('playerData').innerText = '캐시된 데이터를 찾을 수 없습니다.';
            }
        }

        // 테이블 변경을 감지하고 높이 맞추는 함수
        function observeTableChanges() {
            const targetNode = document.getElementById('scrollableTable');
            const config = { childList: true, subtree: true };

            const observer = new MutationObserver(() => {
                matchRowHeights(); // 테이블 변경 후 높이 맞추기
            });

            observer.observe(targetNode, config);
        }

        // 정렬 후 테이블 렌더링과 높이 맞추기
        function sortBy(column, columnIndex) {
            const cachedData = JSON.parse(localStorage.getItem('cachedData'));
            const data = cachedData?.playerRecord;
        
            if (data) {
                // 내림차순 정렬로 고정
                data.sort((a, b) => {
                    let valA = a[column];
                    let valB = b[column];
        
                    if (!isNaN(valA) && !isNaN(valB)) {
                        valA = Number(valA);
                        valB = Number(valB);
                    }
        
                    if (valA > valB) return -1;
                    if (valA < valB) return 1;
                    return 0;
                });
        
                // 테이블 렌더링
                displayPlayerRecord();
        
                // 선택된 열 강조
                highlightSelectedColumn(columnIndex);
            }
        }
        
        function matchRowHeights() {
            const fixedRows = document.querySelectorAll('.fixed-column tr');
            const scrollableRows = document.querySelectorAll('.scrollable-table tr');

            fixedRows.forEach((row, index) => {
                const fixedHeight = row.getBoundingClientRect().height; // 고정된 이름 열의 높이 계산
                const scrollableHeight = scrollableRows[index].getBoundingClientRect().height; // 나머지 테이블의 높이 계산
                const maxHeight = Math.max(fixedHeight, scrollableHeight);

                row.style.height = `${maxHeight}px`; // 동일한 높이 적용
                scrollableRows[index].style.height = `${maxHeight}px`; // 동일한 높이 적용
            });
        }

        window.onload = function() {
            displayPlayerRecord();
            observeTableChanges(); // 테이블 변경을 감지하고 높이 맞추기
        };
    </script>
    
</head>
<body>
    <h1>선수 기록</h1>
    <div class="table-container">
        <div id="fixedColumn"></div> <!-- 이름 열 -->
        <div class="scrollable-table-container">
            <div id="scrollableTable"></div> <!-- 나머지 기록 -->
        </div>
    </div>
</body>
</html>
