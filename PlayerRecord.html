<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>선수 기록 보기</title>
    <script>
        let currentSortColumn = 1; // 기본 정렬을 득점(1번째 열)으로 설정
        let currentSortDirection = 'desc'; // 기본 내림차순

        function sortTable(data, column, direction) {
            return data.sort((a, b) => {
                let valA = a[column];
                let valB = b[column];
                
                // 숫자일 경우 숫자 비교, 아니면 문자열 비교
                if (!isNaN(valA) && !isNaN(valB)) {
                    valA = Number(valA);
                    valB = Number(valB);
                }

                if (valA > valB) {
                    return direction === 'desc' ? -1 : 1;
                }
                if (valA < valB) {
                    return direction === 'desc' ? 1 : -1;
                }
                return 0;
            });
        }

        function displayPlayerRecord() {
            const cachedData = JSON.parse(localStorage.getItem('cachedData'));
            const data = cachedData?.playerRecord;

            if (data) {
                let sortedData = sortTable(data, '득점', currentSortDirection); // 기본 정렬 득점으로 설정

                let html = '<table border="1"><tr><th>이름</th><th onclick="sortBy(\'득점\')">득점</th><th onclick="sortBy(\'도움\')">도움</th><th onclick="sortBy(\'공격포인트\')">공격포인트</th><th onclick="sortBy(\'경기수\')">경기수</th><th onclick="sortBy(\'MOM\')">MOM</th><th onclick="sortBy(\'승\')">승</th><th onclick="sortBy(\'패\')">패</th><th>년도</th></tr>';

                sortedData.forEach(player => {
                    html += `<tr>
                                <td>${player[0]}</td> <!-- 이름 -->
                                <td>${player[1]}</td> <!-- 득점 -->
                                <td>${player[2]}</td> <!-- 도움 -->
                                <td>${player[3]}</td> <!-- 공격포인트 -->
                                <td>${player[4]}</td> <!-- 경기수 -->
                                <td>${player[5]}</td> <!-- MOM -->
                                <td>${player[6]}</td> <!-- 승 -->
                                <td>${player[7]}</td> <!-- 패 -->
                                <td>${player[8]}</td> <!-- 년도 -->
                             </tr>`;
                });
                html += '</table>';

                document.getElementById('playerData').innerHTML = html;
            } else {
                document.getElementById('playerData').innerText = '캐시된 데이터를 찾을 수 없습니다.';
            }
        }

        // 특정 열을 기준으로 정렬
        function sortBy(column) {
            const cachedData = JSON.parse(localStorage.getItem('cachedData'));
            const data = cachedData?.playerRecord;

            if (data) {
                // 열이 동일할 경우 방향을 반전, 아니면 기본 내림차순으로 설정
                if (currentSortColumn === column) {
                    currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSortDirection = 'desc'; // 새로운 열 선택 시 기본 내림차순
                    currentSortColumn = column;
                }

                let sortedData = sortTable(data, column, currentSortDirection);
                let html = '<table border="1"><tr><th>이름</th><th onclick="sortBy(\'득점\')">득점</th><th onclick="sortBy(\'도움\')">도움</th><th onclick="sortBy(\'공격포인트\')">공격포인트</th><th onclick="sortBy(\'경기수\')">경기수</th><th onclick="sortBy(\'MOM\')">MOM</th><th onclick="sortBy(\'승\')">승</th><th onclick="sortBy(\'패\')">패</th><th>년도</th></tr>';

                sortedData.forEach(player => {
                    html += `<tr>
                                <td>${player[0]}</td> <!-- 이름 -->
                                <td>${player[1]}</td> <!-- 득점 -->
                                <td>${player[2]}</td> <!-- 도움 -->
                                <td>${player[3]}</td> <!-- 공격포인트 -->
                                <td>${player[4]}</td> <!-- 경기수 -->
                                <td>${player[5]}</td> <!-- MOM -->
                                <td>${player[6]}</td> <!-- 승 -->
                                <td>${player[7]}</td> <!-- 패 -->
                                <td>${player[8]}</td> <!-- 년도 -->
                             </tr>`;
                });
                html += '</table>';

                document.getElementById('playerData').innerHTML = html;
            }
        }

        window.onload = displayPlayerRecord;
    </script>
</head>
<body>
    <h1>선수 기록</h1>
    <div id="playerData">캐싱데이터 불러오는 중...</div>
</body>
</html>
